

Google OAuth Callback URL configured as: https://sahabai-production.up.railway.app/auth/google/callback

🔵 [WIRD ROUTES] Initializing wird-routes.ts

[DATABASE] Using database storage

[WIRD ROUTER] Storage initialized successfully

🔵 [WIRD ROUTES] Registering routes:

🔵 [WIRD ROUTES] Registering POST /api/wirds/generate-suggestions route

[DATABASE] Using database storage

Storage initialized at routes startup

 

 

🔍 [SERVER INIT] Starting server initialization...

🔍 [SERVER INIT] Initialization timestamp: 2025-03-09T20:51:32.465Z

🔍 [SERVER INIT] Environment: production

[DB INIT] Starting database initialization...

[DB INIT] Database URL configured: Yes

[DB INIT] Environment: production

[2025-03-09T20:51:32.466Z] [DATABASE] Starting database initialization...

(node:27) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.

(Use `node --trace-deprecation ...` to show where the warning was created)

[2025-03-09T20:51:32.536Z] [DATABASE] Database module initialized: Using database storage

[DATABASE] Using database storage

[POSTGRES] Initializing PostgreSQL connection pool

[POSTGRES] Database URL configured: Yes

[POSTGRES] Environment: production

[POSTGRES] PostgreSQL connection pool initialized successfully

[2025-03-09T20:51:32.559Z] [DATABASE] Database mode: PostgreSQL

Google OAuth Callback URL configured as: https://sahabai-production.up.railway.app/auth/google/callback

🔵 [WIRD ROUTES] Initializing wird-routes.ts

[DATABASE] Using database storage

[WIRD ROUTER] Storage initialized successfully

🔵 [WIRD ROUTES] Registering routes:

🔵 [WIRD ROUTES] Registering POST /api/wirds/generate-suggestions route

[DATABASE] Using database storage

Storage initialized at routes startup

 

 

🔍 [SERVER INIT] Starting server initialization...

🔍 [SERVER INIT] Initialization timestamp: 2025-03-09T20:51:32.574Z

🔍 [SERVER INIT] Environment: production

[DB INIT] Starting database initialization...

[DB INIT] Database URL configured: Yes

[DB INIT] Environment: production

[2025-03-09T20:51:32.574Z] [DATABASE] Starting database initialization...

(node:27) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.

(Use `node --trace-deprecation ...` to show where the warning was created)

npm warn config production Use `--omit=dev` instead.

 

> rest-express@1.0.0 deploy

> npm run start

 

npm warn config production Use `--omit=dev` instead.

 

> rest-express@1.0.0 start

> NODE_ENV=production node dist/index.js

 

[2025-03-09T20:51:32.906Z] [DATABASE] Database connection test successful

[2025-03-09T20:51:32.906Z] [DATABASE] Database connection established successfully

[2025-03-09T20:51:32.887Z] [DATABASE] Database connection test successful

[2025-03-09T20:51:32.887Z] [DATABASE] Database connection established successfully

[2025-03-09T20:51:32.940Z] [DATABASE] Database initialization complete

[DB INIT] Database initialization completed successfully

[2025-03-09T20:51:32.940Z] [DATABASE] Database initialization completed successfully

[DB INIT] Testing database connection...

[DB INIT] Testing database connection

[DB INIT] Database connection test successful

[DB INIT] Checking for users in database...

[DB INIT] Getting user count from database

[DB INIT] Found 0 users in database

🔍 [SERVER INIT] Registering main routes via registerRoutes()...

 

 

🔍 [ROUTE DEBUG] Starting route registration...

🔍 [ROUTE DEBUG] Registration timestamp: 2025-03-09T20:51:32.942Z

[IDENTITY DEBUG] Registering identity framework routes as first priority

[IDENTITY DEBUG] Setting up identity framework routes at top level

🔍 [ROUTE DEBUG] Registering auth debug middleware

🔍 [ROUTE DEBUG] Registering health check endpoint

🔍 [ROUTE DEBUG] Registering Masjidi API routes at /api

🔍 [ROUTE DEBUG] Registering Profile API routes at /api

🔍 [ROUTE DEBUG] Registering Auth routes at /auth

[ROUTE DEBUG] Registering identity framework routes

🔍 [SERVER INIT] Main routes registered successfully
[POSTGRES] PostgreSQL connection pool initialized successfully

[2025-03-09T20:51:33.857Z] [DATABASE] Database mode: PostgreSQL

Google OAuth Callback URL configured as: https://sahabai-production.up.railway.app/auth/google/callback

🔵 [WIRD ROUTES] Initializing wird-routes.ts

[DATABASE] Using database storage

[WIRD ROUTER] Storage initialized successfully

🔵 [WIRD ROUTES] Registering routes:

🔵 [WIRD ROUTES] Registering POST /api/wirds/generate-suggestions route

[DATABASE] Using database storage

Storage initialized at routes startup

 

 

🔍 [SERVER INIT] Starting server initialization...

🔍 [SERVER INIT] Initialization timestamp: 2025-03-09T20:51:33.879Z

🔍 [SERVER INIT] Environment: production

[DB INIT] Starting database initialization...

[DB INIT] Database URL configured: Yes

[DB INIT] Environment: production

[2025-03-09T20:51:33.879Z] [DATABASE] Starting database initialization...

(node:27) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.

(Use `node --trace-deprecation ...` to show where the warning was created)

[2025-03-09T20:51:34.036Z] [DATABASE] Database connection test successful

[2025-03-09T20:51:34.036Z] [DATABASE] Database connection established successfully

[2025-03-09T20:51:34.061Z] [DATABASE] Database initialization complete

[DB INIT] Database initialization completed successfully

[2025-03-09T20:51:34.061Z] [DATABASE] Database initialization completed successfully

[DB INIT] Testing database connection...

[DB INIT] Testing database connection

[DB INIT] Database connection test successful

[DB INIT] Checking for users in database...

[DB INIT] Getting user count from database

[DB INIT] Found 0 users in database

🔍 [SERVER INIT] Registering main routes via registerRoutes()...

 

 

🔍 [ROUTE DEBUG] Starting route registration...

🔍 [ROUTE DEBUG] Registration timestamp: 2025-03-09T20:51:34.063Z

[IDENTITY DEBUG] Registering identity framework routes as first priority

[IDENTITY DEBUG] Setting up identity framework routes at top level

🔍 [ROUTE DEBUG] Registering auth debug middleware

🔍 [ROUTE DEBUG] Registering health check endpoint

🔍 [ROUTE DEBUG] Registering Masjidi API routes at /api

🔍 [ROUTE DEBUG] Registering Profile API routes at /api

🔍 [ROUTE DEBUG] Registering Auth routes at /auth

[ROUTE DEBUG] Registering identity framework routes

🔍 [SERVER INIT] Main routes registered successfully

🔍 [SERVER INIT] Registering additional routes...

🔍 [SERVER INIT] Registering profile routes at /api

🔍 [SERVER INIT] Registering health routes at /api

🔍 [SERVER INIT] Registering insights routes at /api

🚀 ROUTE REGISTRATION ORDER:

1. Registering wird routes at /api

2. Registering user routes at /api/user

3. Registering reflection routes at /api/reflections

4. Registering halaqa routes at /api/halaqas

🔍 [SERVER INIT] Registering auth routes at /auth

🔍 [SERVER INIT] Registering auth routes at /api/auth

🔍 [SERVER INIT] Registering compatibility routes

🔍 [SERVER INIT] Registering transcription routes

[2025-03-09T20:51:34.067Z] [INFO] Server running on port 8080

[2025-03-09T20:51:30.900Z] [DATABASE] Database module initialized: Using database storage

[DATABASE] Using database storage

[POSTGRES] Initializing PostgreSQL connection pool

[POSTGRES] Database URL configured: Yes

[POSTGRES] Environment: production

[POSTGRES] PostgreSQL connection pool initialized successfully

[2025-03-09T20:51:30.925Z] [DATABASE] Database mode: PostgreSQL

Google OAuth Callback URL configured as: https://sahabai-production.up.railway.app/auth/google/callback

🔵 [WIRD ROUTES] Initializing wird-routes.ts

[DATABASE] Using database storage

[WIRD ROUTER] Storage initialized successfully

🔵 [WIRD ROUTES] Registering routes:

🔵 [WIRD ROUTES] Registering POST /api/wirds/generate-suggestions route

[DATABASE] Using database storage

Storage initialized at routes startup

 [DB INIT] Testing database connection...

[DB INIT] Testing database connection

[DB INIT] Database connection test successful

[DB INIT] Checking for users in database...

[DB INIT] Getting user count from database

[DB INIT] Found 0 users in database

🔍 [SERVER INIT] Registering main routes via registerRoutes()...

 

 

🔍 [ROUTE DEBUG] Starting route registration...

🔍 [ROUTE DEBUG] Registration timestamp: 2025-03-09T20:51:34.063Z

[IDENTITY DEBUG] Registering identity framework routes as first priority

[IDENTITY DEBUG] Setting up identity framework routes at top level

🔍 [ROUTE DEBUG] Registering auth debug middleware

🔍 [ROUTE DEBUG] Registering health check endpoint

🔍 [ROUTE DEBUG] Registering Masjidi API routes at /api

🔍 [ROUTE DEBUG] Registering Profile API routes at /api

🔍 [ROUTE DEBUG] Registering Auth routes at /auth

[ROUTE DEBUG] Registering identity framework routes

🔍 [SERVER INIT] Main routes registered successfully

🔍 [SERVER INIT] Registering additional routes...

🔍 [SERVER INIT] Registering profile routes at /api

🔍 [SERVER INIT] Registering health routes at /api

🔍 [SERVER INIT] Registering insights routes at /api

🚀 ROUTE REGISTRATION ORDER:

1. Registering wird routes at /api

2. Registering user routes at /api/user

3. Registering reflection routes at /api/reflections

4. Registering halaqa routes at /api/halaqas

🔍 [SERVER INIT] Registering auth routes at /auth

🔍 [SERVER INIT] Registering auth routes at /api/auth

🔍 [SERVER INIT] Registering compatibility routes

🔍 [SERVER INIT] Registering transcription routes

[2025-03-09T20:51:34.067Z] [INFO] Server running on port 8080

[2025-03-09T20:51:30.900Z] [DATABASE] Database module initialized: Using database storage

[DATABASE] Using database storage

[POSTGRES] Initializing PostgreSQL connection pool

[POSTGRES] Database URL configured: Yes

[POSTGRES] Environment: production

[POSTGRES] PostgreSQL connection pool initialized successfully

[2025-03-09T20:51:30.925Z] [DATABASE] Database mode: PostgreSQL

Google OAuth Callback URL configured as: https://sahabai-production.up.railway.app/auth/google/callback

🔵 [WIRD ROUTES] Initializing wird-routes.ts

[DATABASE] Using database storage

[WIRD ROUTER] Storage initialized successfully

🔵 [WIRD ROUTES] Registering routes:

🔵 [WIRD ROUTES] Registering POST /api/wirds/generate-suggestions route

[DATABASE] Using database storage

Storage initialized at routes startup

 

 

🔍 [SERVER INIT] Starting server initialization...

🔍 [SERVER INIT] Initialization timestamp: 2025-03-09T20:51:30.943Z

🔍 [SERVER INIT] Environment: production

[DB INIT] Starting database initialization...

[DB INIT] Database URL configured: Yes

[DB INIT] Environment: production

[2025-03-09T20:51:30.943Z] [DATABASE] Starting database initialization...

(node:27) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.

(Use `node --trace-deprecation ...` to show where the warning was created)

[2025-03-09T20:51:31.152Z] [DATABASE] Database connection test successful

[2025-03-09T20:51:31.153Z] [DATABASE] Database connection established successfully

[2025-03-09T20:51:31.175Z] [DATABASE] Database initialization complete

[DB INIT] Database initialization completed successfully

[2025-03-09T20:51:31.175Z] [DATABASE] Database initialization completed successfully

[DB INIT] Testing database connection...

[DB INIT] Testing database connection

[DB INIT] Database connection test successful

 
POSTGRES] Connected to PostgreSQL database

[2025-03-09T20:51:50.532Z] [DATABASE] Connected to PostgreSQL database

[POSTGRES DB] Query result rows: 0

[POSTGRES DB] No profile found for userId: 9bf37726-6f79-4f27-ba6b-4f99ddd8bcf8

[DB DEBUG] Profile lookup result: Not found

[PROFILE ROUTES] Profile lookup result: Not found

[PROFILE ROUTES] Profile not found, returning 404

[2025-03-09T20:51:50.596Z] [INFO] GET /api/profile 404 in 635ms :: {"error":"Profile not found"}

[SERVER] GET /auth/google - Headers: {"host":"www.sahabai.dev","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","cookie":"_tccl_visitor=0ed8cfcc-d4a1-4931-8611-b7a28f1a5248","priority":"u=0, i","referer":"https://www.sahabai.dev/login?signup=true","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"same-origin","sec-fetch-user":"?1","upgrade-insecure-requests":"1","x-forwarded-for":"47.187.213.159","x-forwarded-host":"www.sahabai.dev","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"4YeXLMJ2REiVnMABfnF_OQ_603524580","x-real-ip":"47.187.213.159","x-request-start":"1741553513479"}

[AUTH DEBUG] GET /auth/google Headers: {"authorization":"Not provided","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","referer":"https://www.sahabai.dev/login?signup=true";}

[AUTH DEBUG] No valid authorization header found

Redirecting to Google OAuth URL: https://accounts.google.com/o/oauth2/v2/auth?access_type=offline&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email&include_granted_scopes=true&prompt=consent&state=signup&client_id=906861922390-1ch884k3sof33c8m4pslf60a2hbilf4p.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Fsahabai-production.up.railway.app%2Fauth%2Fgoogle%2Fcallback&response_type=code&login_hint=&hd=*

[SERVER] GET /auth/google/callback - Headers: {"host":"sahabai-production.up.railway.app","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","cache-control":"max-age=0","priority":"u=0, i","referer":"https://accounts.google.com/","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"cross-site","sec-fetch-user":"?1","upgrade-insecure-requests":"1","x-browser-channel":"stable","x-browser-copyright":"Copyright 2025 Google LLC. All rights reserved.","x-browser-validation":"UK7woQTl0LwbDwavjSMmUGvi26g=","x-browser-year":"2025","x-forwarded-for":"47.187.213.159","x-forwarded-host":"sahabai-production.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"HlwJmqrDRX2sF_FRTI-UIQ_603524580","x-real-ip":"47.187.213.159","x-request-start":"1741553521912"}

[AUTH DEBUG] GET /auth/google/callback Headers: {"authorization":"Not provided","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","referer":"https://accounts.google.com/";}

[AUTH DEBUG] No valid authorization header found

OAuth callback received: { code: 'present', state: 'signup', action: 'signup' }

OAuth callback: Got authorization code, exchanging for tokens (action: signup)

OAuth callback: Successfully exchanged code for tokens: {

  access_token: 'present',

  id_token: 'present',

  expiry_date: 1741557121129

}

OAuth callback: Requesting user info from Google

OAuth callback: Raw user info response: {

  config: {

    url: 'https://www.googleapis.com/oauth2/v3/userinfo';,

    method: 'GET',

    headers: {

      Authorization: 'Bearer ya29.a0AeXRPp5KZYDLIMRWGb2BzptDbAaztjST3kqh_LH_bvlxGXWgOt2_j7Bs7rv6n_1UO3o_g_8whIE3Qtrp095KWPH_eMm4tJs7_SQRybJ59qKdfdbGrJ63QS5v169CC2QSRIBsFHLb2jYmoqXvI5ZGesRgVGt8qEE_BjqOjIlcaCgYKAWkSARISFQHGX2MizmCdTmZi4Qv9IaAjDtQXCA0175',

      'User-Agent': 'google-api-nodejs-client/9.15.1',

      'x-goog-api-client': 'gl-node/22.11.0'

    },

    paramsSerializer: [Function: paramsSerializer],

    validateStatus: [Function: validateStatus],

    responseType: 'unknown',

    errorRedactor: [Function: defaultErrorRedactor]

  },

  data: {

    sub: '110694986574655216341',

    name: 'Sohail Mohammad',

    given_name: 'Sohail',

    family_name: 'Mohammad',

    picture: 'https://lh3.googleusercontent.com/a/ACg8ocKGcS0YhKSQuo9dqfar-DFlOqjG3nZFNYBaZcgLnc_qeKW8wOJAsQ=s96-c';,

    email: 'sohailm25@gmail.com',

    email_verified: true

  },

  headers: {

    'alt-svc': 'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000',

    'cache-control': 'no-cache, no-store, max-age=0, must-revalidate',

    'content-encoding': 'gzip',

    'content-type': 'application/json; charset=utf-8',

    date: 'Sun, 09 Mar 2025 20:52:02 GMT',

    expires: 'Mon, 01 Jan 1990 00:00:00 GMT',

    pragma: 'no-cache',

    server: 'ESF',

    'transfer-encoding': 'chunked',

    vary: 'Origin, X-Origin, Referer',

    'x-content-type-options': 'nosniff',

    'x-frame-options': 'SAMEORIGIN',

    'x-xss-protection': '0'

  },

  status: 200,

  statusText: 'OK',

  request: { responseURL: 'https://www.googleapis.com/oauth2/v3/userinfo'; }

}

OAuth callback: Parsed user info: {

  email: 'sohailm25@gmail.com',

  name: 'Sohail Mohammad',

  sub: '110694986574655216341'

}

OAuth callback: Checking if user exists in database

OAuth callback: Creating new user in database

[USER CREATION] Starting user creation process with data: {

  email: 'sohailm25@gmail.com',

  name: 'Sohail Mohammad',

  googleId: 'Present',

[PROFILE CREATION] Starting profile creation for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE CREATION] Profile data: {

  userId: '1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06',

  preferences: '{"inputMethod":"text","reflectionFrequency":"daily","languagePreferences":"english"}...',

  sharingPreferences: '{"localStorageOnly":false,"allowPersonalization":true,"enableSync":true}...'

}

[PROFILE CREATION] Database mode: PostgreSQL

[PROFILE CREATION] Using database storage for profile creation

[POSTGRES DB] Creating profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[POSTGRES DB] Executing INSERT query

[POSTGRES DB] Error creating user profile: column "version" of relation "user_profiles" does not exist

[2025-03-09T20:52:53.782Z] [ERROR] Error creating user profile: column "version" of relation "user_profiles" does not exist

[2025-03-09T20:52:53.783Z] [ERROR] Error creating user profile: column "version" of relation "user_profiles" does not exist

[PROFILE CREATION] Error creating user profile: column "version" of relation "user_profiles" does not exist

[PROFILE ROUTES] Token validation error: error: column "version" of relation "user_profiles" does not exist

    at /app/node_modules/pg-pool/index.js:45:11

    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)

    at async createUserProfile (file:///app/dist/index.js:3606:20)

    at async createUserProfile2 (file:///app/dist/index.js:3973:24)

    at async file:///app/dist/index.js:4447:19 {

  length: 134,

  severity: 'ERROR',

  code: '42703',

  detail: undefined,

  hint: undefined,

  position: '111',

  internalPosition: undefined,

  internalQuery: undefined,

  where: undefined,

  schema: undefined,

  table: undefined,

  column: undefined,

  dataType: undefined,

  constraint: undefined,

  file: 'parse_target.c',

  line: '1066',

  routine: 'checkInsertTargets'

}

[2025-03-09T20:52:53.787Z] [INFO] POST /api/profile/create 401 in 675ms :: {"error":"Invalid authentication token…

[SERVER] POST /api/profile - Headers: {"host":"sahabai-production.up.railway.app","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","content-length":"246","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","authorization":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxYjE1NmZjNS05OTRjLTRiNGMtYThmMS02NWE5Y2U2ZmZlMDYiLCJpYXQiOjE3NDE1NTM1NzIsImV4cCI6MTc0MjE1ODM3Mn0.-hHT6_Au2uE3TXh1jj9kGS-te8EIcZ8O5ZIL7sh3uFE","content-type":"application/json","origin":"https://www.sahabai.dev","priority":"u=1, i","referer":"https://www.sahabai.dev/","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site","x-forwarded-for":"47.187.213.159","x-forwarded-host":"sahabai-production.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"Mu0kP_bSSn2zBaI9C2FG3g_882434190","x-real-ip":"47.187.213.159","x-request-start":"1741553573834"}

[AUTH DEBUG] POST /api/profile Headers: {"authorization":"Bearer [hidden for security]","content-type":"application/json","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","origin":"https://www.sahabai.dev","referer":"https://www.sahabai.dev/";}

[AUTH DEBUG] Token format: eyJhbGciOi...ZIL7sh3uFE

[AUTH DEBUG] Token decode attempt: Success - Payload: {"userId":"1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06","iat":1741553572,"exp":1742158372}

[PROFILE ROUTES] POST / request received

[PROFILE ROUTES] Headers: {"host":"sahabai-production.up.railway.app","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","content-length":"246","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","authorization":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxYjE1NmZjNS05OTRjLTRiNGMtYThmMS02NWE5Y2U2ZmZlMDYiLCJpYXQiOjE3NDE1NTM1NzIsImV4cCI6MTc0MjE1ODM3Mn0.-hHT6_Au2uE3TXh1jj9kGS-te8EIcZ8O5ZIL7sh3uFE","content-type":"application/json","origin":"https://www.sahabai.dev","priority":"u=1, i","referer":"https://www.sahabai.dev/","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site","x-forwarded-for":"47.187.213.159","x-forwarded-host":"sahabai-production.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"Mu0kP_bSSn2zBaI9C2FG3g_882434190","x-real-ip":"47.187.213.159","x-request-start":"1741553573834"}

[PROFILE ROUTES] POST /profile - Starting profile creation

[PROFILE ROUTES] Request body: {"userId":"1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06","generalPreferences":{"inputMethod":"text","reflectionFrequency":"daily","languagePreferences":"english"},"privacySettings":{"localStorageOnly":false,"allowPersonalization":true,"enableSync":true}}

[PROFILE ROUTES] Request headers: {"host":"sahabai-production.up.railway.app","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","content-length":"246","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","authorization":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxYjE1NmZjNS05OTRjLTRiNGMtYThmMS02NWE5Y2U2ZmZlMDYiLCJpYXQiOjE3NDE1NTM1NzIsImV4cCI6MTc0MjE1ODM3Mn0.-hHT6_Au2uE3TXh1jj9kGS-te8EIcZ8O5ZIL7sh3uFE","content-type":"application/json","origin":"https://www.sahabai.dev","priority":"u=1, i","referer":"https://www.sahabai.dev/","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site","x-forwarded-for":"47.187.213.159","x-forwarded-host":"sahabai-production.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"Mu0kP_bSSn2zBaI9C2FG3g_882434190","x-real-ip":"47.187.213.159","x-request-start":"1741553573834"}

[PROFILE ROUTES] Auth header present: true
[POSTGRES DB] Query result rows: 0

[POSTGRES DB] No profile found for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[DB DEBUG] Profile lookup result: Not found

[PROFILE ROUTES] Profile exists check result: Not found

[PROFILE ROUTES] Creating new profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE CREATION] Starting profile creation for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE CREATION] Profile data: {

  userId: '1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06',

  preferences: '{"inputMethod":"text","reflectionFrequency":"daily","languagePreferences":"english"}...',

  sharingPreferences: '{"localStorageOnly":false,"allowPersonalization":true,"enableSync":true}...'

}

[PROFILE CREATION] Database mode: PostgreSQL

[PROFILE CREATION] Using database storage for profile creation

[POSTGRES DB] Creating profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[POSTGRES DB] Executing INSERT query

[POSTGRES DB] Error creating user profile: column "version" of relation "user_profiles" does not exist

[2025-03-09T20:52:53.782Z] [ERROR] Error creating user profile: column "version" of relation "user_profiles" does not exist

[2025-03-09T20:52:53.783Z] [ERROR] Error creating user profile: column "version" of relation "user_profiles" does not exist

[PROFILE CREATION] Error creating user profile: column "version" of relation "user_profiles" does not exist

[PROFILE ROUTES] Token validation error: error: column "version" of relation "user_profiles" does not exist

    at /app/node_modules/pg-pool/index.js:45:11

    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)

    at async createUserProfile (file:///app/dist/index.js:3606:20)

    at async createUserProfile2 (file:///app/dist/index.js:3973:24)

    at async file:///app/dist/index.js:4447:19 {

  length: 134,

  severity: 'ERROR',

  code: '42703',

  detail: undefined,

  hint: undefined,

  position: '111',

  internalPosition: undefined,

  internalQuery: undefined,

  where: undefined,

  schema: undefined,

  table: undefined,

  column: undefined,

  dataType: undefined,

  constraint: undefined,

  file: 'parse_target.c',

  line: '1066',

  routine: 'checkInsertTargets'

}

[2025-03-09T20:52:53.787Z] [INFO] POST /api/profile/create 401 in 675ms :: {"error":"Invalid authentication token…

[PROFILE ROUTES] Token extracted from header: eyJhbGciOi...

[Validate Debug] User found, returning data: {"id":"1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06","email":"sohailm25@gmail.com","name":"Sohail Mohammad"}

[PROFILE ROUTES] Verifying JWT token with secret: sahab...

[PROFILE ROUTES] Request headers: {"host":"sahabai-production.up.railway.app","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","authorization":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxYjE1NmZjNS05OTRjLTRiNGMtYThmMS02NWE5Y2U2ZmZlMDYiLCJpYXQiOjE3NDE1NTM1NzIsImV4cCI6MTc0MjE1ODM3Mn0.-hHT6_Au2uE3TXh1jj9kGS-te8EIcZ8O5ZIL7sh3uFE","content-type":"application/json","origin":"https://www.sahabai.dev","priority":"u=1, i","referer":"https://www.sahabai.dev/","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site","x-forwarded-for":"47.187.213.159","x-forwarded-host":"sahabai-production.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"JBnhi_HDRIejiRI1Snp9jQ_2074704348","x-real-ip":"47.187.213.159","x-request-start":"1741553587405"}

[PROFILE ROUTES] JWT verification successful, userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE ROUTES] Auth header present: true

[PROFILE ROUTES] Full decoded payload: {"userId":"1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06","iat":1741553572,"exp":1742158372}

[SERVER] GET /favicon.ico - Headers: {"host":"www.sahabai.dev","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","accept":"image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","cookie":"_tccl_visitor=0ed8cfcc-d4a1-4931-8611-b7a28f1a5248","if-modified-since":"Sun, 09 Mar 2025 20:50:47 GMT","if-none-match":"W/\"959-1957cacb058\"","priority":"u=1, i","referer":"https://www.sahabai.dev/home","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"image","sec-fetch-mode":"no-cors","sec-fetch-site":"same-origin","x-forwarded-for":"47.187.213.159","x-forwarded-host":"www.sahabai.dev","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"5vESYpjZRq2PmSIlJnyZVQ_1002618245","x-real-ip":"47.187.213.159","x-request-start":"1741553586870"}

[PROFILE ROUTES] Auth header: Bearer eyJhbGci...

[PROFILE ROUTES] Profile requested for authenticated user: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE ROUTES] Token extracted from header: eyJhbGciOi...

[AUTH DEBUG] GET /favicon.ico Headers: {"authorization":"Not provided","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","referer":"https://www.sahabai.dev/home";}

[PROFILE ROUTES] Looking up profile in database for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[AUTH DEBUG] No valid authorization header found

[DB DEBUG] Getting user profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE ROUTES] Verifying JWT token with secret: sahab...

[DB DEBUG] Database mode: PostgreSQL

[PROFILE ROUTES] JWT verification successful, userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[DB DEBUG] Using database storage

[SERVER] GET /auth/validate - Headers: {"host":"sahabai-production.up.railway.app","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","authorization":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxYjE1NmZjNS05OTRjLTRiNGMtYThmMS02NWE5Y2U2ZmZlMDYiLCJpYXQiOjE3NDE1NTM1NzIsImV4cCI6MTc0MjE1ODM3Mn0.-hHT6_Au2uE3TXh1jj9kGS-te8EIcZ8O5ZIL7sh3uFE","content-type":"application/json","origin":"https://www.sahabai.dev","priority":"u=1, i","referer":"https://www.sahabai.dev/","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site","x-forwarded-for":"47.187.213.159","x-forwarded-host":"sahabai-production.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"6GRWBH0JT_SzfgcObRvfbw_2074704348","x-real-ip":"47.187.213.159","x-request-start":"1741553586882"}

[POSTGRES DB] Looking up profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE ROUTES] Full decoded payload: {"userId":"1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06","iat":1741553572,"exp":1742158372}

[POSTGRES DB] Executing query: SELECT * FROM user_profiles WHERE user_id = $1

[AUTH DEBUG] GET /auth/validate Headers: {"authorization":"Bearer [hidden for security]","content-type":"application/json","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","origin":"https://www.sahabai.dev","referer":"https://www.sahabai.dev/";}

[PROFILE ROUTES] Looking up profile in database for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[PROFILE ROUTES] Profile requested for authenticated user: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[AUTH DEBUG] Token format: eyJhbGciOi...ZIL7sh3uFE

[PROFILE ROUTES] Looking up profile in database for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[DB DEBUG] Getting user profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[AUTH DEBUG] Token decode attempt: Success - Payload: {"userId":"1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06","iat":1741553572,"exp":1742158372}

[DB DEBUG] Getting user profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[SERVER] GET /manifest.json - Headers: {"host":"www.sahabai.dev","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","if-modified-since":"Sun, 09 Mar 2025 20:50:47 GMT","if-none-match":"W/\"1e5-1957cacb058\"","priority":"u=2","referer":"https://www.sahabai.dev/home","sec-ch-ua":";\"Not(A:Brand\";v=\"99\", \"Google Chrome\";v=\"133\", \"Chromium\";v=\"133\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"manifest","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-forwarded-for":"47.187.213.159","x-forwarded-host":"www.sahabai.dev","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4","x-railway-request-id":"LFL36VOITvqhmrmTt2nAmA_1002618245","x-real-ip":"47.187.213.159","x-request-start":"1741553586922"}

[DB DEBUG] Database mode: PostgreSQL

[Validate Debug] Starting token validation

[DB DEBUG] Database mode: PostgreSQL

[Validate Debug] Request path: /validate

[DB DEBUG] Using database storage

[DB DEBUG] Using database storage

[AUTH DEBUG] GET /manifest.json Headers: {"authorization":"Not provided","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36","referer":"https://www.sahabai.dev/home";}

[Validate Debug] Request method: GET

[POSTGRES DB] Looking up profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[POSTGRES DB] Looking up profile for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[AUTH DEBUG] No valid authorization header found

[Validate Debug] Auth header present: true

[POSTGRES DB] Query result rows: 0

[POSTGRES DB] Executing query: SELECT * FROM user_profiles WHERE user_id = $1

[Validate Debug] Auth header: Bearer eyJhbGci...

[POSTGRES DB] Executing query: SELECT * FROM user_profiles WHERE user_id = $1

[POSTGRES DB] Query result rows: 0

[POSTGRES DB] No profile found for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[POSTGRES DB] Query result rows: 0

[Validate Debug] Token extracted from header: eyJhbGciOi...

[POSTGRES DB] No profile found for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[DB DEBUG] Profile lookup result: Not found

[POSTGRES DB] No profile found for userId: 1b156fc5-994c-4b4c-a8f1-65a9ce6ffe06

[DB DEBUG] Profile lookup result: Not found

[Validate Debug] Verifying JWT token with secret: sahab...

[PROFILE ROUTES] Profile lookup result: Not found

